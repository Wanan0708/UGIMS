# 未实现功能清单

## 📋 第二阶段：核心功能（部分完成）

### ✅ 已完成
- [x] 管网可视化展示
- [x] 空间查询功能（点查询、框查询、圆查询、缓冲区查询）
- [x] 连通性分析基础算法（图遍历、环检测、路径查找）
- [x] 系统设置功能
- [x] 设备详情对话框
- [x] 工单管理UI和基本功能（创建、编辑、查看、删除、筛选）
- [x] 资产管理UI和基本功能（查看、编辑、筛选）

### ⚠️ 部分完成（需要完善）

#### 1. 连通性分析算法
**位置**: `src/analysis/connectivityanalyzer.cpp`

- [ ] **`findAllPaths()`** - 查找两点间的所有路径
  - 当前状态：返回模拟数据
  - 需要实现：使用图遍历算法（DFS/BFS）查找所有可能路径
  - 优先级：中

- [ ] **`dfsTrace()`** - 深度优先搜索追踪
  - 当前状态：空实现
  - 需要实现：递归DFS算法用于上下游追踪
  - 优先级：中

#### 2. 地图绘制功能
**位置**: `src/ui/myform.cpp`, `src/map/mapdrawingmanager.cpp`

- [x] 管线绘制功能（已实现）
- [ ] **设施绘制功能**
  - 当前状态：标记为TODO，只显示提示对话框
  - 需要实现：在地图上点击绘制设施点
  - 优先级：高

#### 3. 地图标注渲染
**位置**: `src/map/layermanager.cpp:153`

- [ ] **标注图层渲染**
  - 当前状态：TODO注释
  - 需要实现：管线编号、设施名称等文字标注的渲染
  - 优先级：中

#### 4. 分析面板功能
**位置**: `src/ui/analysispanel.cpp:159`

- [ ] **最短路径分析**
  - 当前状态：显示提示"需要选择两个点"
  - 需要实现：在地图上选择起点和终点，执行路径分析
  - 优先级：高

#### 5. 下载调度器功能
**位置**: `src/tilemap/downloadscheduler.h:26-28`

- [ ] **`pauseTask()`** - 暂停指定任务
  - 当前状态：TODO标记
  - 需要实现：暂停单个下载任务
  - 优先级：低

- [ ] **`resumeTask()`** - 恢复指定任务
  - 当前状态：TODO标记
  - 需要实现：恢复暂停的下载任务
  - 优先级：低

- [ ] **`cancelTask()`** - 取消指定任务
  - 当前状态：TODO标记
  - 需要实现：取消并删除下载任务
  - 优先级：低

### 📅 第三阶段：高级分析（未开始）

- [ ] 水力模拟（基于 EPANET 引擎）
- [ ] 管网健康度评估模型（完整实现）
- [ ] 改造优先级算法
- [ ] AI 异常检测（基于历史数据）
- [ ] 预测性维护（故障预测）

### 📅 第四阶段：移动端（未开始）

- [ ] Android APP（巡检、报修）
- [ ] iOS APP
- [ ] 移动端离线数据包
- [ ] 实时数据同步
- [ ] 语音录入和识别

### 📅 第五阶段：集成与扩展（未开始）

- [ ] BIM模型集成（3D可视化）
- [ ] IoT设备接入（压力监测、流量计）
- [ ] 视频监控集成
- [ ] GIS服务发布（WMS/WFS）
- [ ] 大屏展示系统
- [ ] 数据大屏可视化

---

## 🎯 优先级建议

### 高优先级（第二阶段核心功能完善）
1. **设施绘制功能** - 完善地图绘制工具
2. **最短路径分析** - 完善分析面板功能
3. **工单状态流转** - 完善工单管理业务逻辑（状态转换、通知等）
4. **资产统计报表** - 完善资产管理功能（导出、统计等）

### 中优先级（提升用户体验）
1. **标注渲染** - 地图标注显示
2. **findAllPaths算法** - 完善连通性分析
3. **dfsTrace实现** - 完善追踪算法

### 低优先级（优化功能）
1. **下载任务管理** - pauseTask/resumeTask/cancelTask
2. **性能优化** - 大数据量渲染优化
3. **错误处理** - 更完善的异常处理

---

## 📊 完成度统计

### 第二阶段核心功能
- **总体完成度**: 约 75%
- **已完成**: 6/10 项
- **部分完成**: 4/10 项
- **未开始**: 0/10 项

### 项目整体
- **第一阶段（基础平台）**: ✅ 100% 完成
- **第二阶段（核心功能）**: 🚧 75% 完成
- **第三阶段（高级分析）**: 📅 0% 完成
- **第四阶段（移动端）**: 📅 0% 完成
- **第五阶段（集成扩展）**: 📅 0% 完成

---

## 🔍 详细说明

### 1. 连通性分析 - findAllPaths
**问题**: 当前返回模拟数据，需要实现真实的图遍历算法。

**实现思路**:
- 使用DFS或BFS遍历所有从起点到终点的路径
- 限制最大路径数量避免组合爆炸
- 考虑环路检测，避免无限循环

### 2. 设施绘制功能
**问题**: 只有管线绘制实现了，设施绘制还是TODO。

**实现思路**:
- 复用MapDrawingManager的绘制逻辑
- 点击地图直接放置设施点
- 右键或双击完成绘制

### 3. 最短路径分析
**问题**: 分析面板中需要用户选择两个点，但交互未实现。

**实现思路**:
- 进入"选择起点"模式
- 用户点击地图选择起点
- 自动切换到"选择终点"模式
- 用户点击地图选择终点
- 执行路径分析并显示结果

### 4. 标注渲染
**问题**: LayerManager中有TODO注释，标注图层未实现。

**实现思路**:
- 创建TextRenderer类
- 根据缩放级别决定是否显示标注
- 避免标注重叠（碰撞检测）

### 5. 下载任务管理
**问题**: DownloadScheduler中的任务控制方法未实现。

**实现思路**:
- 维护任务状态（pending/running/paused/cancelled）
- pauseTask: 停止下载线程，保存进度
- resumeTask: 从保存的进度恢复下载
- cancelTask: 删除任务和已下载文件

---

**最后更新**: 2025-01-26

