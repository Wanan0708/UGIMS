# ğŸ”Œ æ•°æ®åº“è¿æ¥æµ‹è¯•æŒ‡å—

## ğŸ¯ å¿«é€Ÿæ£€æŸ¥

### 1. PostgreSQL æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥æœåŠ¡
sc query postgresql-x64-16

# å¯åŠ¨æœåŠ¡ï¼ˆå¦‚æœæœªè¿è¡Œï¼‰
net start postgresql-x64-16
```

**é¢„æœŸè¾“å‡º**:
```
STATE: 4  RUNNING
```

---

### 2. é…ç½®æ–‡ä»¶æ£€æŸ¥

```bash
# æŸ¥çœ‹æ•°æ®åº“é…ç½®
type config\database.ini
```

**å…³é”®é…ç½®**:
```ini
[database]
type=postgresql
host=localhost
port=5432
dbname=ugims
username=postgres
password=ä½ çš„å¯†ç   # âš ï¸ ç¡®ä¿å¯†ç æ­£ç¡®ï¼
```

---

### 3. æ‰‹åŠ¨æµ‹è¯•è¿æ¥

```bash
# ä½¿ç”¨ psql æµ‹è¯•
psql -U postgres -d postgres -c "SELECT 1"

# æ£€æŸ¥ ugims æ•°æ®åº“æ˜¯å¦å­˜åœ¨
psql -U postgres -d postgres -c "\l" | findstr ugims
```

**å¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒ**:
```bash
# åˆ›å»ºæ•°æ®åº“
createdb -U postgres ugims

# æˆ–ä½¿ç”¨ SQL
psql -U postgres
CREATE DATABASE ugims;
\q

# å¯ç”¨ PostGIS
psql -U postgres -d ugims -c "CREATE EXTENSION postgis;"

# å¯¼å…¥ç»“æ„
psql -U postgres -d ugims -f database\schema.sql

# å¯¼å…¥æµ‹è¯•æ•°æ®
psql -U postgres -d ugims -f database\test_data.sql
```

---

## ğŸš€ åœ¨ Qt Creator ä¸­è°ƒè¯•

### æ­¥éª¤ 1: å¯åŠ¨è°ƒè¯•

æŒ‰ `F5` æˆ–ç‚¹å‡»è°ƒè¯•æŒ‰é’®

### æ­¥éª¤ 2: æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º

**æˆåŠŸçš„è¾“å‡º**:
```
[Pipeline] Step 1: Initialize Logger
[Pipeline] Application dir: E:/Project/.../debug
[Pipeline] âœ… Logger initialized at: E:/.../logs/app.log

[Pipeline] Step 2: Load Config
[Path] âŒ Not found: .../debug/../../config/app.ini
[Path] âœ… Found config at: E:/.../config/app.ini
[Pipeline] âœ… App config loaded

[Pipeline] Step 3: Load Database Config
[Path] âœ… Found config at: E:/.../config/database.ini
[Pipeline] âœ… Database config loaded

[Pipeline] Step 4: Connect to Database
[Pipeline] Initializing DatabaseManager...

[DB] Type: postgresql
[DB] Host: localhost
[DB] Port: 5432
[DB] Database: ugims
[DB] Username: postgres
[DB] Password: ***

[Pipeline] Connecting to database (timeout: 5s)...
[Pipeline] âœ… Database connected
[INFO] PostGIS version: 3.x.x

[Pipeline] Step 5: Create LayerManager
[Pipeline] âœ… LayerManager created
```

---

## âŒ å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### é”™è¯¯ 1: è¿æ¥è¶…æ—¶

**è¾“å‡º**:
```
[Pipeline] âŒ DB connect failed: æ•°æ®åº“è¿æ¥è¶…æ—¶ï¼Œè¯·æ£€æŸ¥PostgreSQLæ˜¯å¦è¿è¡Œ
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æœåŠ¡
sc query postgresql-x64-16

# å¯åŠ¨æœåŠ¡
net start postgresql-x64-16
```

---

### é”™è¯¯ 2: å¯†ç é”™è¯¯

**è¾“å‡º**:
```
[Pipeline] âŒ DB connect failed: æ•°æ®åº“å¯†ç é”™è¯¯ï¼Œè¯·æ£€æŸ¥config/database.ini
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
notepad config\database.ini

# ä¿®æ”¹å¯†ç è¡Œ
password=ä½ çš„å®é™…å¯†ç 

# æˆ–é‡ç½® PostgreSQL å¯†ç 
psql -U postgres
ALTER USER postgres WITH PASSWORD 'æ–°å¯†ç ';
\q
```

---

### é”™è¯¯ 3: æ•°æ®åº“ä¸å­˜åœ¨

**è¾“å‡º**:
```
[Pipeline] âŒ DB connect failed: æ•°æ®åº“ä¸å­˜åœ¨ï¼Œè¯·å…ˆåˆ›å»ºugimsæ•°æ®åº“
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# åˆ›å»ºæ•°æ®åº“
createdb -U postgres ugims

# å¯ç”¨æ‰©å±•å’Œå¯¼å…¥æ•°æ®
psql -U postgres -d ugims -c "CREATE EXTENSION postgis;"
psql -U postgres -d ugims -f database\schema.sql
psql -U postgres -d ugims -f database\test_data.sql
```

---

### é”™è¯¯ 4: é©±åŠ¨ä¸å¯ç”¨

**è¾“å‡º**:
```
[Pipeline] âŒ DB connect failed: Driver not loaded
```

**åŸå› **: Qt æœªç¼–è¯‘ PostgreSQL é©±åŠ¨

**æ£€æŸ¥**:
```cpp
// åœ¨ä»£ç ä¸­æ·»åŠ è°ƒè¯•
QStringList drivers = QSqlDatabase::drivers();
qDebug() << "Available drivers:" << drivers;
```

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ Qt å®‰è£…æ—¶åŒ…å«äº† PostgreSQL é©±åŠ¨
2. æ£€æŸ¥æ˜¯å¦æœ‰ `libpq.dll` åœ¨ç³»ç»Ÿè·¯å¾„ä¸­
3. å¯èƒ½éœ€è¦é‡æ–°å®‰è£… Qt å¹¶é€‰æ‹© PostgreSQL æ”¯æŒ

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹å¯ç”¨çš„æ•°æ®åº“é©±åŠ¨

åœ¨ `main.cpp` æˆ– `myform.cpp` ä¸­æ·»åŠ ï¼š
```cpp
#include <QSqlDatabase>
qDebug() << "Available SQL drivers:" << QSqlDatabase::drivers();
```

**åº”è¯¥åŒ…å«**: `QPSQL` (PostgreSQL)

### 2. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
Get-Content logs\app.log -Wait -Tail 30

# ç­›é€‰é”™è¯¯
Get-Content logs\app.log | Select-String "ERROR|error"

# ç­›é€‰æ•°æ®åº“ç›¸å…³
Get-Content logs\app.log | Select-String "DB|Database|Pipeline"
```

### 3. æµ‹è¯•ç½‘ç»œè¿æ¥

```bash
# æµ‹è¯• PostgreSQL ç«¯å£
Test-NetConnection -ComputerName localhost -Port 5432
```

---

## âœ… æˆåŠŸæ ‡å¿—

å½“çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºæ—¶ï¼Œè¯´æ˜æ•°æ®åº“è¿æ¥æˆåŠŸï¼š

```
[Pipeline] âœ… Database connected
[INFO] PostGIS version: 3.x.x
[Pipeline] âœ… LayerManager created
```

**çª—å£çŠ¶æ€æ æ˜¾ç¤º**:
```
æ•°æ®åº“å·²è¿æ¥ï¼Œå‡†å¤‡åŠ è½½ç®¡ç½‘æ•°æ®...
```

**5-10ç§’å**:
- åœ°å›¾ä¸Šæ˜¾ç¤ºå½©è‰²ç®¡çº¿
- æ˜¾ç¤ºè®¾æ–½ç‚¹ï¼ˆé˜€é—¨ã€æ£€æŸ¥äº•ç­‰ï¼‰

---

## ğŸ“ æ£€æŸ¥æ¸…å•

åœ¨è¿è¡Œç¨‹åºå‰ï¼Œç¡®è®¤ï¼š

- [ ] PostgreSQL æœåŠ¡æ­£åœ¨è¿è¡Œ
- [ ] `config/database.ini` å­˜åœ¨ä¸”å¯†ç æ­£ç¡®
- [ ] `ugims` æ•°æ®åº“å·²åˆ›å»º
- [ ] PostGIS æ‰©å±•å·²å¯ç”¨
- [ ] æ•°æ®è¡¨å·²å¯¼å…¥ï¼ˆè¿è¡Œ `database/schema.sql`ï¼‰
- [ ] æµ‹è¯•æ•°æ®å·²å¯¼å…¥ï¼ˆè¿è¡Œ `database/test_data.sql`ï¼‰
- [ ] Qt åŒ…å« PostgreSQL é©±åŠ¨ï¼ˆ`QPSQL`ï¼‰

---

## ğŸ†˜ ä»ç„¶æ— æ³•è¿æ¥ï¼Ÿ

### æä¾›ä»¥ä¸‹ä¿¡æ¯ä»¥è·å¾—å¸®åŠ©ï¼š

1. **æ§åˆ¶å°å®Œæ•´è¾“å‡º** ï¼ˆç‰¹åˆ«æ˜¯ `[DB]` å’Œ `[Pipeline]` å¼€å¤´çš„è¡Œï¼‰
2. **æ—¥å¿—æ–‡ä»¶å†…å®¹** ï¼ˆ`logs/app.log`ï¼‰
3. **PostgreSQL ç‰ˆæœ¬** ï¼ˆ`psql --version`ï¼‰
4. **Qt ç‰ˆæœ¬å’Œå¯ç”¨é©±åŠ¨** ï¼ˆ`QSqlDatabase::drivers()`ï¼‰
5. **å…·ä½“é”™è¯¯ä¿¡æ¯**

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [DATABASE_SETUP.md](DATABASE_SETUP.md) - è¯¦ç»†æ•°æ®åº“è®¾ç½®
- [å¯ç”¨ç®¡ç½‘å¯è§†åŒ–æŒ‡å—.md](å¯ç”¨ç®¡ç½‘å¯è§†åŒ–æŒ‡å—.md) - å®Œæ•´åŠŸèƒ½æŒ‡å—
- [PROJECT_STRUCTURE.md](PROJECT_STRUCTURE.md) - é¡¹ç›®ç»“æ„

---

**ç¥æµ‹è¯•é¡ºåˆ©ï¼** ğŸ‰

