# 菜单栏设计方案

## 📋 当前功能模块分析

根据代码分析，当前项目包含以下功能模块：

### 1. 文件操作
- 新建、打开、保存、另存为
- 撤销、重做
- 导入/导出数据

### 2. 管网管理
- 管网可视化展示
- 管线绘制（给水、排水、燃气、电力、通信、供热）
- 设施绘制（阀门、井盖、泵站、变压器、调压站、接线盒）
- 图层控制（显示/隐藏、样式设置）
- 实体编辑（属性编辑、删除）

### 3. 空间分析
- 爆管影响分析
- 连通性分析（上游追踪、下游追踪、最短路径、所有路径）
- 健康度评估
- 空间查询（点查询、框查询、圆查询、缓冲区查询）

### 4. 工单管理
- 工单创建、编辑、查看、删除
- 工单状态流转（派发、开始、完成、取消）
- 工单筛选和查询

### 5. 资产管理
- 资产台账管理
- 资产统计报表（多维度统计）
- 资产导出（Excel、PDF）

### 6. 地图管理
- 在线/离线地图切换
- 离线地图下载
- 地图管理器

### 7. 系统设置
- 系统配置
- 用户管理
- 权限管理

### 8. 帮助
- 帮助文档
- 关于系统

---

## 🎯 菜单栏设计方案

### 方案一：6个主菜单（精简版）

```
文件(F) | 管网(P) | 分析(A) | 工单(W) | 资产(A) | 工具(T)
```

#### 详细结构：

**1. 文件(F)**
- 新建项目 (Ctrl+N)
- 打开项目 (Ctrl+O)
- 保存 (Ctrl+S)
- 另存为 (Ctrl+Shift+S)
- ────────────────
- 导入数据
  - 导入管线数据
  - 导入设施数据
  - 导入CAD图纸
- 导出数据
  - 导出当前视图
  - 导出选中数据
- ────────────────
- 最近打开的文件
- ────────────────
- 退出 (Alt+F4)

**2. 管网(P)**
- 绘制工具
  - 绘制管线
  - 绘制设施
- 图层管理
  - 图层控制面板
  - 显示所有图层
  - 隐藏所有图层
- 实体操作
  - 编辑属性
  - 删除选中
  - 复制/粘贴
- ────────────────
- 刷新图层 (F5)
- 清除选择 (Esc)

**3. 分析(A)**
- 爆管影响分析
- 连通性分析
  - 上游追踪
  - 下游追踪
  - 最短路径
  - 所有路径
- 健康度评估
- ────────────────
- 空间查询
  - 点查询
  - 框查询
  - 圆查询
  - 缓冲区查询

**4. 工单(W)**
- 新建工单 (Ctrl+W)
- 工单管理
- ────────────────
- 工单筛选
  - 按状态筛选
  - 按类型筛选
  - 按时间筛选
- ────────────────
- 刷新工单列表 (F5)

**5. 资产(A)**
- 资产管理
- 资产统计
- ────────────────
- 资产查询
  - 快速查找
  - 高级查询
- ────────────────
- 导出报表
  - 导出Excel
  - 导出PDF

**6. 工具(T)**
- 地图管理
  - 下载离线地图
  - 地图管理器
- ────────────────
- 系统设置 (Ctrl+,)
- ────────────────
- 帮助 (F1)
- 关于 (Ctrl+?)

---

### 方案二：8个主菜单（完整版）

```
文件(F) | 管网(P) | 分析(A) | 工单(W) | 资产(A) | 地图(M) | 设置(S) | 帮助(H)
```

#### 详细结构：

**1. 文件(F)** - 同方案一

**2. 管网(P)** - 同方案一

**3. 分析(A)** - 同方案一

**4. 工单(W)** - 同方案一

**5. 资产(A)** - 同方案一

**6. 地图(M)**
- 在线/离线切换
- 下载离线地图
- 地图管理器
- ────────────────
- 地图工具
  - 定位到坐标
  - 测量距离
  - 测量面积
- ────────────────
- 地图样式
  - 切换底图
  - 调整透明度

**7. 设置(S)**
- 系统设置
- 用户管理
- 权限管理
- ────────────────
- 视图设置
  - 显示设置
  - 性能设置
- ────────────────
- 数据设置
  - 数据库配置
  - 缓存管理

**8. 帮助(H)**
- 帮助文档 (F1)
- 用户手册
- 快捷键列表
- ────────────────
- 检查更新
- ────────────────
- 关于 UGIMS (Ctrl+?)

---

## 💡 推荐方案

**推荐使用方案一（6个主菜单）**，理由：

1. **更简洁**：符合现代软件设计趋势，减少菜单项数量
2. **逻辑清晰**：将相关功能合并（地图管理并入工具菜单）
3. **易于使用**：菜单项更少，用户更容易找到功能
4. **符合项目规模**：当前项目功能相对集中，6个菜单足够

---

## 🔧 实现建议

### 菜单栏位置
- 建议放在 `BaseWindow` 的标题栏下方
- 或者放在 `MyForm` 的顶部（标题栏下方）

### 快捷键设计
- 遵循常见软件习惯（Ctrl+N新建、Ctrl+S保存等）
- 避免与系统快捷键冲突
- 提供快捷键提示（菜单项后显示）

### 权限控制
- 根据用户权限显示/隐藏菜单项
- 禁用无权限的功能项

### 状态管理
- 根据当前状态启用/禁用菜单项
- 例如：未选择实体时禁用"编辑属性"

---

## 📝 实施步骤

1. **创建菜单栏类**
   - 在 `BaseWindow` 或 `MyForm` 中创建 `QMenuBar`
   - 设置菜单样式

2. **创建菜单项**
   - 按照设计方案创建各个菜单
   - 连接信号和槽

3. **实现功能映射**
   - 将现有按钮功能映射到菜单项
   - 保持功能一致性

4. **添加快捷键**
   - 为常用功能添加快捷键
   - 实现快捷键处理

5. **权限集成**
   - 集成权限管理系统
   - 根据权限显示/隐藏菜单

6. **测试和优化**
   - 测试所有菜单功能
   - 优化用户体验

---

**最后更新**: 2025-01-27

