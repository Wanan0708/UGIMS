# ğŸ—„ï¸ åˆ›å»º UGIMS æ•°æ®åº“

**å½“å‰é—®é¢˜**: ç¨‹åºæ— æ³•è¿æ¥æ•°æ®åº“ï¼Œå› ä¸º `ugims` æ•°æ®åº“ä¸å­˜åœ¨ã€‚

---

## âœ… **å¿«é€Ÿè§£å†³ï¼ˆæ¨èï¼‰**

### æ–¹æ³•1: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ â­â­â­â­â­

```bash
# è¿è¡Œåˆ›å»ºè„šæœ¬ï¼ˆä¼šæç¤ºè¾“å…¥å¯†ç ï¼‰
.\scripts\create_database.bat
```

**è„šæœ¬ä¼šè‡ªåŠ¨**:
1. âœ… æµ‹è¯• PostgreSQL è¿æ¥
2. âœ… åˆ›å»º `ugims` æ•°æ®åº“
3. âœ… å¯ç”¨ PostGIS æ‰©å±•
4. âœ… å¯¼å…¥æ•°æ®åº“ç»“æ„
5. âœ… å¯¼å…¥æµ‹è¯•æ•°æ®
6. âœ… éªŒè¯æ•°æ®

---

### æ–¹æ³•2: æ‰‹åŠ¨åˆ›å»º

#### æ­¥éª¤1: æ‰“å¼€ PostgreSQL å‘½ä»¤è¡Œ

```bash
# æ–¹å¼A: ä½¿ç”¨ psql
psql -U postgres

# æ–¹å¼B: ä½¿ç”¨ pgAdminï¼ˆå›¾å½¢ç•Œé¢ï¼‰
# æ‰“å¼€ pgAdmin â†’ è¿æ¥åˆ° PostgreSQL
```

#### æ­¥éª¤2: åˆ›å»ºæ•°æ®åº“

```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE ugims ENCODING 'UTF8';

-- é€€å‡º
\q
```

#### æ­¥éª¤3: è¿æ¥åˆ°æ–°æ•°æ®åº“

```bash
psql -U postgres -d ugims
```

#### æ­¥éª¤4: å¯ç”¨ PostGIS æ‰©å±•

```sql
-- å¯ç”¨ PostGIS
CREATE EXTENSION IF NOT EXISTS postgis;

-- å¯ç”¨ UUIDï¼ˆå¯é€‰ï¼‰
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- é€€å‡º
\q
```

#### æ­¥éª¤5: å¯¼å…¥æ•°æ®åº“ç»“æ„

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
psql -U postgres -d ugims -f database\schema.sql
```

#### æ­¥éª¤6: å¯¼å…¥æµ‹è¯•æ•°æ®

```bash
psql -U postgres -d ugims -f database\test_data.sql
```

---

## ğŸ” **éªŒè¯æ•°æ®åº“**

### æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨

```bash
psql -U postgres -c "\l" | findstr ugims
```

**é¢„æœŸè¾“å‡º**:
```
 ugims | postgres | UTF8 | ...
```

### æ£€æŸ¥è¡¨æ˜¯å¦åˆ›å»º

```bash
psql -U postgres -d ugims -c "\dt"
```

**é¢„æœŸè¾“å‡º**:
```
           List of relations
 Schema |       Name       | Type  |  Owner
--------+------------------+-------+----------
 public | pipelines        | table | postgres
 public | facilities       | table | postgres
 public | work_orders      | table | postgres
 ...
```

### æ£€æŸ¥æ•°æ®æ˜¯å¦å¯¼å…¥

```bash
# ç®¡çº¿æ•°é‡
psql -U postgres -d ugims -c "SELECT COUNT(*) FROM pipelines;"

# è®¾æ–½æ•°é‡
psql -U postgres -d ugims -c "SELECT COUNT(*) FROM facilities;"
```

**é¢„æœŸè¾“å‡º**:
```
ç®¡çº¿: 5 æ¡
è®¾æ–½: 4 ä¸ª
```

### æ£€æŸ¥ PostGIS æ˜¯å¦å¯ç”¨

```bash
psql -U postgres -d ugims -c "SELECT PostGIS_Version();"
```

**é¢„æœŸè¾“å‡º**:
```
         postgis_version
---------------------------------
 3.x USE_GEOS=1 USE_PROJ=1 ...
```

---

## âš ï¸ **å¸¸è§é—®é¢˜**

### é—®é¢˜1: psql å‘½ä»¤ä¸å¯ç”¨

**é”™è¯¯**:
```
'psql' is not recognized as an internal or external command
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ‰¾åˆ° PostgreSQL å®‰è£…ç›®å½•
# ä¾‹å¦‚: C:\Program Files\PostgreSQL\16\bin

# ä½¿ç”¨å®Œæ•´è·¯å¾„
"C:\Program Files\PostgreSQL\16\bin\psql.exe" -U postgres

# æˆ–æ·»åŠ åˆ° PATH ç¯å¢ƒå˜é‡
```

---

### é—®é¢˜2: å¯†ç éªŒè¯å¤±è´¥

**é”™è¯¯**:
```
password authentication failed for user "postgres"
```

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤å¯†ç æ­£ç¡®
2. ä¿®æ”¹ `config/database.ini` ä¸­çš„å¯†ç 
3. æˆ–é‡ç½® PostgreSQL å¯†ç ï¼š
```bash
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
psql -U postgres
ALTER USER postgres WITH PASSWORD 'æ–°å¯†ç ';
\q
```

---

### é—®é¢˜3: æƒé™ä¸è¶³

**é”™è¯¯**:
```
permission denied to create database
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä½¿ç”¨è¶…çº§ç”¨æˆ·åˆ›å»º
psql -U postgres -c "CREATE DATABASE ugims;"

# æˆ–æˆäºˆåˆ›å»ºæ•°æ®åº“æƒé™
psql -U postgres
ALTER USER postgres CREATEDB;
\q
```

---

### é—®é¢˜4: æ•°æ®åº“å·²å­˜åœ¨ä½†æ•°æ®ä¸å¯¹

**è§£å†³æ–¹æ¡ˆ**:
```bash
# åˆ é™¤å¹¶é‡æ–°åˆ›å»º
psql -U postgres
DROP DATABASE IF EXISTS ugims;
CREATE DATABASE ugims ENCODING 'UTF8';
\q

# é‡æ–°å¯¼å…¥
psql -U postgres -d ugims -c "CREATE EXTENSION postgis;"
psql -U postgres -d ugims -f database\schema.sql
psql -U postgres -d ugims -f database\test_data.sql
```

---

## ğŸš€ **åˆ›å»ºå®Œæˆå**

### é‡æ–°è¿è¡Œç¨‹åº

```bash
# åœ¨ Qt Creator ä¸­
æŒ‰ F5 è°ƒè¯•

# æˆ–ç›´æ¥è¿è¡Œ
.\release\CustomTitleBarApp.exe
```

### é¢„æœŸæ—¥å¿—è¾“å‡º

```
[Pipeline] Step 4: Connect to Database
[DB] Type: "postgresql"
[DB] Host: "localhost"
[DB] Port: 5432
[DB] Database: "ugims"
[DB] Username: "postgres"
[DB] Password: ***
[Pipeline] Connecting to database (timeout: 5s)...
[Pipeline] âœ… Database connected            â† æˆåŠŸï¼
[INFO] PostGIS version: 3.x.x
[Pipeline] Step 5: Create LayerManager
[Pipeline] âœ… LayerManager created
```

### é¢„æœŸçª—å£æ˜¾ç¤º

- **çŠ¶æ€æ **: "æ•°æ®åº“å·²è¿æ¥ï¼Œå‡†å¤‡åŠ è½½ç®¡ç½‘æ•°æ®..."
- **5-10ç§’å**: åœ°å›¾ä¸Šæ˜¾ç¤ºå½©è‰²ç®¡çº¿å’Œè®¾æ–½ç‚¹
- **å¯ä»¥**: æ‹–æ‹½ã€ç¼©æ”¾ã€ç‚¹å‡»æŸ¥çœ‹ç®¡çº¿å±æ€§

---

## ğŸ“Š **æµ‹è¯•æ•°æ®è¯´æ˜**

åˆ›å»ºæ•°æ®åº“åï¼Œå°†åŒ…å«ä»¥ä¸‹æµ‹è¯•æ•°æ®ï¼š

### ç®¡çº¿æ•°æ® (5æ¡)
- ğŸ”µ ç»™æ°´ç®¡çº¿ x 2
  - å¤©å®‰é—¨å¹¿åœºç»™æ°´ä¸»å¹²ç®¡
  - é•¿å®‰è¡—ç»™æ°´æ”¯çº¿
- ğŸŸ¤ æ’æ°´ç®¡çº¿ x 1
  - æ•…å®«é›¨æ°´ç®¡é“
- ğŸŸ¡ ç‡ƒæ°”ç®¡çº¿ x 1
  - è¥¿å•ç‡ƒæ°”ä¸­å‹ç®¡
- ğŸ”´ ç”µåŠ›ç”µç¼† x 1
  - ç‹åºœäº•ç”µåŠ›ä¸»å¹²çº¿

### è®¾æ–½æ•°æ® (4ä¸ª)
- ğŸŸ¢ é˜€é—¨ x 2
  - å¤©å®‰é—¨1å·ã€2å·é˜€é—¨äº•
- ğŸ”µ æ£€æŸ¥äº• x 1
  - æ•…å®«é›¨æ°´æ£€æŸ¥äº•1å·
- ğŸŸ  æ³µç«™ x 1
  - é•¿å®‰è¡—åŠ å‹æ³µç«™

### æ•°æ®ä½ç½®
æ‰€æœ‰æµ‹è¯•æ•°æ®ä½äº**åŒ—äº¬å¤©å®‰é—¨é™„è¿‘**:
- ä¸­å¿ƒåæ ‡: 116.4Â°E, 39.9Â°N
- ç¼©æ”¾ç­‰çº§: 15-17 æœ€ä½³

---

## ğŸ“ **æ£€æŸ¥æ¸…å•**

åˆ›å»ºæ•°æ®åº“å‰ï¼Œç¡®è®¤ï¼š

- [ ] PostgreSQL æœåŠ¡æ­£åœ¨è¿è¡Œ
- [ ] çŸ¥é“ `postgres` ç”¨æˆ·çš„å¯†ç 
- [ ] æœ‰åˆ›å»ºæ•°æ®åº“çš„æƒé™
- [ ] `database/schema.sql` æ–‡ä»¶å­˜åœ¨
- [ ] `database/test_data.sql` æ–‡ä»¶å­˜åœ¨

åˆ›å»ºæ•°æ®åº“åï¼Œç¡®è®¤ï¼š

- [ ] `ugims` æ•°æ®åº“å­˜åœ¨
- [ ] PostGIS æ‰©å±•å·²å¯ç”¨
- [ ] 10ä¸ªæ•°æ®è¡¨å·²åˆ›å»º
- [ ] 5æ¡ç®¡çº¿æ•°æ®å·²å¯¼å…¥
- [ ] 4ä¸ªè®¾æ–½æ•°æ®å·²å¯¼å…¥

---

## ğŸ¯ **å¿«é€Ÿå‘½ä»¤å‚è€ƒ**

```bash
# åˆ›å»ºæ•°æ®åº“ï¼ˆä¸€æ¡å‘½ä»¤å®Œæˆæ‰€æœ‰æ­¥éª¤ï¼‰
psql -U postgres -c "CREATE DATABASE ugims;" && ^
psql -U postgres -d ugims -c "CREATE EXTENSION postgis;" && ^
psql -U postgres -d ugims -f database\schema.sql && ^
psql -U postgres -d ugims -f database\test_data.sql

# éªŒè¯
psql -U postgres -d ugims -c "SELECT COUNT(*) FROM pipelines;"
psql -U postgres -d ugims -c "SELECT COUNT(*) FROM facilities;"
```

---

**ç°åœ¨è¿è¡Œåˆ›å»ºè„šæœ¬å¼€å§‹å§ï¼** ğŸš€

```bash
.\scripts\create_database.bat
```

